<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/styles.css" />
    <title>3-Themed Calculator</title>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>calc</h1>
        <div class="theme">
          <p class="theme-text">THEME</p>
          <div class="theme-toggle">
            <div class="theme-numbers">
              <p>1</p>
              <p>2</p>
              <p>3</p>
            </div>
            <div class="toggle-container">
              <div class="pointer"></div>
            </div>
          </div>
        </div>
      </header>

      <div class="calculator-input">
        <input type="text" id="display" />
      </div>

      <div class="calculator-button-container">
        <div class="calculator-buttons" id="calculator-buttons">
          <button>7</button>
          <button>8</button>
          <button>9</button>
          <button class="del">DEL</button>
          <button>4</button>
          <button>5</button>
          <button>6</button>
          <button>+</button>
          <button>1</button>
          <button>2</button>
          <button>3</button>
          <button>-</button>
          <button>.</button>
          <button>0</button>
          <button>/</button>
          <button>×</button>
          <button class="reset">RESET</button>
          <button class="equals">=</button>
        </div>
      </div>
    </div>

    <script>
      /*============================= THEME CHANGE LOGIC =============================*/
      const toggleContainer = document.querySelector('.toggle-container');
      const pointer = document.querySelector('.pointer');
      const headerTypography = document.querySelectorAll(
        'header h1, header p, .calculator-input input'
      );
      const calculatorInput = document.querySelector('.calculator-input');
      const calculatorButtonContainer = document.querySelector(
        '.calculator-button-container'
      );
      const buttons = document.querySelectorAll('.calculator-buttons button');
      const delButton = document.querySelector('.del');
      const resetButton = document.querySelector('.reset');
      const equalButton = document.querySelector('.equals');

      const themes = {
        pointerThemes: ['#d13f30', '#d13f30', '#00ded0'],
        containerThemes: ['#252d44', '#d3cdcd', '#1e0836'],
        backgroundThemes: ['#3b4664', '#e6e6e6', '#17062a'],
        headerTypographyThemes: ['#fff', '#313329', '#e2cf5a'],
        calculatorInputThemes: ['#181f32', '#eeeeee', '#1e0836'],
        calculatorButtonContainerThemes: ['#252d44', '#d3cdcd', '#1e0836'],
        primaryButtonThemes: ['#eae3db', '#e5e4e0', '#331b4d'],
        primaryButtonTypographyThemes: ['#3d4753', '#313329', '#e2cf5a'],
        primaryButtonBorderThemes: ['#aa9e91', '#a69c95', '#78248f'],
        secondaryButtonThemes: ['#637297', '#388187', '#56067d'],
        secondaryButtonBorderThemes: ['#434c73', '#215c62', '#aa22de'],
        equalButtonBorderThemes: ['#902112', '#902112', '#6cf8f1'],
        equalButtonTypographyThemes: ['white', 'white', 'black'],
      };

      let currentThemeIndex = 0;

      const updateTheme = () => {
        currentThemeIndex =
          (currentThemeIndex + 1) % themes.pointerThemes.length;
      };

      const changeColor = (element, theme) => {
        element.style.color = theme;
      };

      const changeBackgroundColor = (element, theme) => {
        element.style.backgroundColor = theme;
      };

      const changeBorderColor = (element, theme) => {
        element.style.borderColor = theme;
      };

      const applyTheme = () => {
        const currentPointerTheme = themes.pointerThemes[currentThemeIndex];
        const currentContainerTheme = themes.containerThemes[currentThemeIndex];
        const currentBackgroundTheme =
          themes.backgroundThemes[currentThemeIndex];
        const currentHeaderTypographyTheme =
          themes.headerTypographyThemes[currentThemeIndex];
        const currentCalculatorInputTheme =
          themes.calculatorInputThemes[currentThemeIndex];
        const currentCalculatorButtonContainerTheme =
          themes.calculatorButtonContainerThemes[currentThemeIndex];
        const currentPrimaryButtonTheme =
          themes.primaryButtonThemes[currentThemeIndex];
        const currentPrimaryButtonTypographyTheme =
          themes.primaryButtonTypographyThemes[currentThemeIndex];
        const currentSecondaryButtonTheme =
          themes.secondaryButtonThemes[currentThemeIndex];
        const currentPrimaryButtonBorderTheme =
          themes.primaryButtonBorderThemes[currentThemeIndex];
        const currentSecondaryButtonBorderTheme =
          themes.secondaryButtonBorderThemes[currentThemeIndex];
        const currentEqualButtonBorderTheme =
          themes.equalButtonBorderThemes[currentThemeIndex];
        const currentEqualButtonTypographyTheme =
          themes.equalButtonTypographyThemes[currentThemeIndex];

        //Adjust position of pointer
        pointer.style.transform = `translateX(${currentThemeIndex * 24}px)`;

        //Change Color
        headerTypography.forEach((element) => {
          changeColor(element, currentHeaderTypographyTheme);
        });
        changeBackgroundColor(calculatorInput, currentCalculatorInputTheme);
        changeBackgroundColor(
          calculatorButtonContainer,
          currentCalculatorButtonContainerTheme
        );
        changeBackgroundColor(toggleContainer, currentContainerTheme);
        changeBackgroundColor(pointer, currentPointerTheme);
        changeBackgroundColor(document.body, currentBackgroundTheme);
        buttons.forEach((button) => {
          if (button === delButton || button === resetButton) {
            changeBackgroundColor(button, currentSecondaryButtonTheme);
            changeBorderColor(button, currentSecondaryButtonBorderTheme);
          } else if (button === equalButton) {
            changeBackgroundColor(button, currentPointerTheme);
            changeBorderColor(button, currentEqualButtonBorderTheme);
            changeColor(button, currentEqualButtonTypographyTheme);
          } else {
            changeBackgroundColor(button, currentPrimaryButtonTheme);
            changeBorderColor(button, currentPrimaryButtonBorderTheme);
            changeColor(button, currentPrimaryButtonTypographyTheme);
          }
        });
      };

      toggleContainer.addEventListener('click', () => {
        updateTheme();
        applyTheme();
      });

      /*============================= CALCULATOR LOGIC =============================*/
      const display = document.getElementById('display');

      const keyboardMapping = {
        '1': '1',
        '2': '2',
        '3': '3',
        '4': '4',
        '5': '5',
        '6': '6',
        '7': '7',
        '8': '8',
        '9': '9',
        '0': '0',
        '+': '+',
        '-': '-',
        '*': '×',
        '/': '/',
        '.': '.',
        Enter: '=',
        Backspace: 'DEL',
        Escape: 'RESET',
      };

      //Keyboard input
      document.addEventListener('keydown', (event) => {
        const key = event.key;
        if (keyboardMapping[key]) {
          event.preventDefault();
          const buttonText = keyboardMapping[key];
          simulateButtonClick(buttonText);

          // Highlight button effect
          buttons.forEach((button) => {
            if (button.textContent === buttonText) {
              button.classList.add('active');
            }
          });
        }
      });

      // Remove "active" class on keyup
      document.addEventListener('keyup', () => {
        buttons.forEach((button) => {
          button.classList.remove('active');
        });
      });

      // Add click event listener
      buttons.forEach((button) => {
        button.addEventListener('click', () => {
          const buttonText = button.textContent;
          simulateButtonClick(buttonText);
        });
      });

      //Number formatting
      display.addEventListener('input', () => {
        // Replace '×' with '*'
        display.value = display.value.replace(/×/g, '*');
        // Input validation (ignores non-numeric characters)
        display.value = display.value.replace(/[^0-9.+\-*/]/g, '');
        display.value = Number(display.value).toLocaleString();
      });

      //Calculator logic
      const simulateButtonClick = (buttonText) => {
        if (display.value === 'Syntax Error') {
          if (
            buttonText === 'DEL' ||
            buttonText === 'RESET' ||
            buttonText === '='
          ) {
            display.value = '';
          } else {
            display.value = buttonText;
          }
        } else if (buttonText === '=') {
          try {
            let expression = display.value.replace(/×/g, '*').replace(/,/g, '');
            const result = eval(expression);
            display.value = result.toLocaleString();
          } catch (error) {
            display.value = 'Syntax Error';
          }
        } else if (buttonText === 'DEL') {
          display.value = display.value.slice(0, -1);
        } else if (buttonText === 'RESET' || display.value === 'RESET') {
          display.value = '';
        } else {
          display.value += buttonText.replace(/×/g, '*');
        }
      };
    </script>
  </body>
</html>
